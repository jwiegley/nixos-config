groups:
  - name: glances_monitoring
    interval: 30s
    rules:
      # Glances service down
      - alert: GlancesServiceDown
        expr: |
          systemd_unit_state{
            name="glances.service",
            state="active",
            type="service"
          } == 0
        for: 2m
        labels:
          severity: warning
          category: monitoring
        annotations:
          summary: "Glances monitoring service is down"
          description: "Glances service is not active on {{ $labels.instance }}"

      # Glances service failed
      - alert: GlancesServiceFailed
        expr: systemd_unit_state{name="glances.service",state="failed",type="service"} == 1
        for: 1m
        labels:
          severity: critical
          category: monitoring
        annotations:
          summary: "Glances service has failed"
          description: "Glances service is in failed state on {{ $labels.instance }}"

      # Glances web endpoint unavailable
      - alert: GlancesWebEndpointDown
        expr: up{job="glances"} == 0
        for: 3m
        labels:
          severity: warning
          category: monitoring
        annotations:
          summary: "Glances web endpoint is not responding"
          description: "Glances Prometheus endpoint at {{ $labels.instance }} is down"

      # Glances high CPU usage detection
      - alert: GlancesHighCPU
        expr: glances_cpu_percent > 90
        for: 5m
        labels:
          severity: warning
          category: system
        annotations:
          summary: "High CPU usage detected by Glances"
          description: "CPU usage is {{ $value }}% on {{ $labels.instance }}"

      # Glances high memory usage detection
      - alert: GlancesHighMemory
        expr: glances_mem_percent > 90
        for: 5m
        labels:
          severity: warning
          category: system
        annotations:
          summary: "High memory usage detected by Glances"
          description: "Memory usage is {{ $value }}% on {{ $labels.instance }}"

      # Glances high disk usage detection
      - alert: GlancesHighDiskUsage
        expr: glances_fs_percent{mnt_point!~"/boot.*|/run.*|/sys.*|/dev.*"} > 85
        for: 10m
        labels:
          severity: warning
          category: storage
        annotations:
          summary: "High disk usage detected by Glances"
          description: "Disk usage on {{ $labels.mnt_point }} is {{ $value }}% on {{ $labels.instance }}"

      # Glances high load average
      - alert: GlancesHighLoadAverage
        expr: glances_load > 4.0
        for: 10m
        labels:
          severity: warning
          category: system
        annotations:
          summary: "High load average detected by Glances"
          description: "Load average is {{ $value }} on {{ $labels.instance }}"

      # Glances metrics stale (not updating)
      - alert: GlancesMetricsStale
        expr: |
          (time() - glances_uptime_seconds) > 300 or
          absent(glances_uptime_seconds)
        for: 5m
        labels:
          severity: warning
          category: monitoring
        annotations:
          summary: "Glances metrics appear stale"
          description: "Glances metrics have not been updated in over 5 minutes on {{ $labels.instance }}"
